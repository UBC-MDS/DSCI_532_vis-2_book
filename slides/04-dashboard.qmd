---
title: Build a dashboard
---

## What do you see?

![](/img/tipping-dashboard.png){width="500px" fig-align="center"}

## Restaurant Tipping dashboard

1. Title: "Restaurant tipping"
    - You can use the [`ui.panel_title()`](https://shiny.posit.co/py/api/core/ui.panel_title.html)
        and pass in a `title=''` parameter

. . .

2. Sidebar for a few input components (we'll add those later)
    - You can put some text here as a place holder, e.g., `"sidebar inputs"`

. . .

3. A full width column with 3 value boxes
    - Each value box will take up the same width of space
    - The value boxes will have separate labels and corresponding summary statistic

. . .

4. A full width column with 2 cards, one for a dataframe and another for a scatter plot
    - Each card will share the same width of space

. . .

5. A full width column with 1 card

## App UI components

Here are the documentation pages for functions that may be useful for this exercise:

- `ui.page_opts()`: <https://shiny.posit.co/py/api/express/express.ui.page_opts.html>
- `ui.sidebar()`: <https://shiny.posit.co/py/api/express/express.ui.sidebar.html>
- `ui.layout_columns()`: <https://shiny.posit.co/py/api/express/express.ui.layout_columns.html>
- `ui.card()`: <https://shiny.posit.co/py/api/express/express.ui.card.html>
- `ui.card_header()`: <https://shiny.posit.co/py/api/express/express.ui.card_header.html>

## App UI

```{shinylive-python}
# | standalone: true
# | #| components: [editor, viewer]
# | layout: horizontal
# | viewerHeight: 500

{{< include /code/lecture02/core/app-01-ui.py >}}
```

## Your turn: Add input components

```{shinylive-python}
# | standalone: true
# | #| components: [editor, viewer]
# | layout: horizontal
# | viewerHeight: 500

{{< include /code/lecture02/core/app-02-input.py >}}
```

## Let's add some data

```{python}
# | echo: true


import seaborn as sns

tips = sns.load_dataset("tips")

total_lower = tips.total_bill.min()
total_upper = tips.total_bill.max()
time_selected = tips.time.unique().tolist()

# many ways you can handle the filter combinations
idx1 = tips.total_bill.between(
    left=total_lower,
    right=total_upper,
    inclusive="both",
)

idx2 = tips.time.isin(time_selected)

tips_filtered = tips[idx1 & idx2]
```

## Calculate values

```{python}
#| echo: true

# total tippers
total_tippers = tips_filtered.shape[0]
print(total_tippers)

# average tip
perc = tips_filtered.tip / tips_filtered.total_bill
average_tip = f"{perc.mean():.1%}"
print(average_tip)

# average bill
bill = tips_filtered.total_bill.mean()
average_bill = f"${bill:.2f}"
print(average_bill)
```

## Scatterplot

```{python}
#| echo: true

import plotly.express as px

px.scatter(
    tips_filtered,
    x="total_bill",
    y="tip",
    trendline="lowess"
)
```

## Ridgeplot

```{python}
#| echo: true

from ridgeplot import ridgeplot

tips_filtered["percent"] = tips_filtered.tip / tips_filtered.total_bill

uvals = tips_filtered.day.unique()
samples = [[tips_filtered.percent[tips_filtered.day == val]] for val in uvals]

plt = ridgeplot(
    samples=samples,
    labels=uvals,
    bandwidth=0.01,
    colorscale="viridis",
    colormode="row-index"
)

plt.update_layout(
    legend=dict(
        orientation="h",
        yanchor="bottom",
        y=1.02,
        xanchor="center",
        x=0.5
    )
)
```

## Add reactive values to the cards

```{shinylive-python}
#| standalone: true
#| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500

{{< include /code/lecture02/core/app-03-values.py >}}
```

## Repeated reactive calculations

Lots of repeated calculations

```{.python}
idx1 = tips.total_bill.between(
    left=input.slider()[0],
    right=input.slider()[1],
    inclusive="both",
)
idx2 = tips.time.isin(input.checkbox_group())
tips_filtered = tips[idx1 & idx2]
```

## Shiny reactive calculations

We can use a `@reactive.calc` to define and save a value that reacts to inputs

```{shinylive-python}
#| standalone: true
#| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500

{{< include /code/lecture02/core/app-04-reactive_calc.py >}}
```


## Reuse reactive calculations

```{shinylive-python}
#| standalone: true
#| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500

{{< include /code/lecture02/core/app-05-reactive_calc_reuse.py >}}
```

## Filtered tips reactive.calc

```{shinylive-python}
# | standalone: true
# | components: [editor, viewer]
# | layout: horizontal
# | viewerHeight: 500

{{< include /code/lecture02/core/app-06-filtered_tips.py >}}
```

## The application (Core)

```{shinylive-python}
#| standalone: true
#| #| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500

{{< include /code/lecture02/core/app.py >}}
```

## Challenge: Button

- Reactive events

<https://shiny.posit.co/py/api/express/express.ui.input_action_button.html>
