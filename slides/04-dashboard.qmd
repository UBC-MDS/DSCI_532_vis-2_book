---
title: Build a dashboard
---

## What do you see?

![](/img/tipping-dashboard.png){width="500px" fig-align="center"}

## Restaurant Tipping dashboard

1. Title: "Restaurant tipping"
    - You can use the [`ui.panel_title()`](https://shiny.posit.co/py/api/core/ui.panel_title.html)
        and pass in a `title=''` parameter

. . .

2. Sidebar for a few input components (we'll add those later)
    - You can put some text here as a place holder, e.g., `"sidebar inputs"`

. . .

3. A full width column with 3 value boxes
    - Each value box will take up the same width of space
    - The value boxes will have separate labels and corresponding summary statistic

. . .

4. A full width column with 2 cards, one for a dataframe and another for a scatter plot
    - Each card will share the same width of space

. . .

5. A full width column with 1 card

## App UI components

Here are the documentation pages for functions that may be useful for this exercise:

- `ui.page_fillable()`: <https://shiny.posit.co/py/api/core/ui.page_fillable.html>
- `ui.layout_sidebar()`: <https://shiny.posit.co/py/api/core/ui.layout_sidebar.html>
- `ui.sidebar()`: <https://shiny.posit.co/py/api/core/ui.sidebar.html>
- `ui.layout_columns()`: <https://shiny.posit.co/py/api/core/ui.layout_columns.html>
- `ui.card()`: <https://shiny.posit.co/py/api/core/ui.card.html>
- `ui.card_header()`: <https://shiny.posit.co/py/api/core/ui.card_header.html>

## App UI

```{shinylive-python}
#| standalone: true
#| #| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500

{{< include /code/lecture02/core/app-01-ui.py >}}
```

## Your turn: Add input components

```{shinylive-python}
#| standalone: true
#| #| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500

from shiny import App, ui

app_ui = ui.page_fillable(
    ui.panel_title("Restaurant tipping"),
    ui.layout_sidebar(
        ui.sidebar(
            ui.input_slider(
                id="slider",
                label="Bill amount",
                min=0,
                max=100,
                value=[0, 100],
            ),
            ui.input_checkbox_group(
                id="checkbox_group",
                label="Food service",
                choices={
                    "Lunch": "Lunch",
                    "Dinner": "Dinner",
                },
                selected=[
                    "Lunch",
                    "Dinner",
                ],
            ),
            ui.input_action_button("action_button", "Reset filter"),
            open="desktop",
        ),
        # first row of value boxes
        ui.layout_columns(
            ui.value_box("Total tippers", "Value 1"),
            ui.value_box("Average tip", "Value 2"),
            ui.value_box("Average bill", "Value 3"),
            fill=False,
        ),
        # second row of cards
        ui.layout_columns(
            ui.card(
                ui.card_header("Tips data"),
                "Tips DataFrame",
                full_screen=True,
            ),
            ui.card(
                ui.card_header("Total bill vs tip"),
                "Scatterplot",
                full_screen=True,
            ),
            col_widths=[6, 6],
        ),
        ui.layout_columns(
            ui.card(
                ui.card_header("Tip percentages"),
                "ridgeplot",
                full_screen=True,
            ),
        ),
    ),
)

def server(input, output, session):
    pass

app = App(app_ui, server)
```

## Let's add some data

```{python}
#| echo: true


import seaborn as sns

tips = sns.load_dataset('tips')

total_lower = tips.total_bill.min()
total_upper = tips.total_bill.max()
time_selected = tips.time.unique().tolist()

idx1 = tips.total_bill.between(
    left=total_lower,
    right=total_upper,
    inclusive="both",
)

idx2 = tips.time.isin(time_selected)

tips_filtered = tips[idx1 & idx2]
```

## Calculate values

```{python}
#| echo: true

# total tippers
total_tippers = tips_filtered.shape[0]
print(total_tippers)

# average tip
perc = tips_filtered.tip / tips_filtered.total_bill
average_tip = f"{perc.mean():.1%}"
print(average_tip)

# average bill
bill = tips_filtered.total_bill.mean()
average_bill = f"${bill:.2f}"
print(average_bill)
```

## Scatterplot

```{python}
#| echo: true

import plotly.express as px

px.scatter(
    tips_filtered,
    x="total_bill",
    y="tip",
    trendline="lowess"
)
```

## Ridgeplot

```{python}
#| echo: true

from ridgeplot import ridgeplot

tips_filtered["percent"] = tips_filtered.tip / tips_filtered.total_bill

uvals = tips_filtered.day.unique()
samples = [[tips_filtered.percent[tips_filtered.day == val]] for val in uvals]

plt = ridgeplot(
    samples=samples,
    labels=uvals,
    bandwidth=0.01,
    colorscale="viridis",
    colormode="row-index"
)

plt.update_layout(
    legend=dict(
        orientation="h",
        yanchor="bottom",
        y=1.02,
        xanchor="center",
        x=0.5
    )
)
```

## Add reactive values to the cards

```{shinylive-python}
#| standalone: true
#| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500

import seaborn as sns
from shiny import App, reactive, render, ui

tips = sns.load_dataset("tips")

app_ui = ui.page_fillable(
    ui.panel_title("Restaurant tipping"),
    ui.layout_sidebar(
        ui.sidebar(
            ui.input_slider(
                id="slider",
                label="Bill amount",
                min=tips.total_bill.min(),
                max=tips.total_bill.max(),
                value=[tips.total_bill.min(), tips.total_bill.max()],
            ),
            ui.input_checkbox_group(
                id="checkbox_group",
                label="Food service",
                choices={
                    "Lunch": "Lunch",
                    "Dinner": "Dinner",
                },
                selected=[
                    "Lunch",
                    "Dinner",
                ],
            ),
            ui.input_action_button("action_button", "Reset filter"),
            open="desktop",
        ),
        # first row of value boxes
        ui.layout_columns(
            ui.value_box("Total tippers", ui.output_text("total_tippers")),
            ui.value_box("Average tip", ui.output_text("average_tip")),
            ui.value_box("Average bill", ui.output_text("average_bill")),
            fill=False,
        ),
    ),
)


def server(input, output, session):
    @render.text
    def total_tippers():
        idx1 = tips.total_bill.between(
            left=input.slider()[0],
            right=input.slider()[1],
            inclusive="both",
        )
        idx2 = tips.time.isin(input.checkbox_group())
        tips_filtered = tips[idx1 & idx2]
        return str(tips_filtered.shape[0])

    @render.text
    def average_tip():
        idx1 = tips.total_bill.between(
            left=input.slider()[0],
            right=input.slider()[1],
            inclusive="both",
        )
        idx2 = tips.time.isin(input.checkbox_group())
        tips_filtered = tips[idx1 & idx2]
        perc = tips_filtered.tip / tips_filtered.total_bill
        return f"{perc.mean():.1%}"

    @render.text
    def average_bill():
        idx1 = tips.total_bill.between(
            left=input.slider()[0],
            right=input.slider()[1],
            inclusive="both",
        )
        idx2 = tips.time.isin(input.checkbox_group())
        tips_filtered = tips[idx1 & idx2]
        bill = tips_filtered.total_bill.mean()
        return f"${bill:.2f}"


app = App(app_ui, server)
```

## Repeated reactive calculations

Lots of repeated calculations

```{.python}
idx1 = tips.total_bill.between(
    left=input.slider()[0],
    right=input.slider()[1],
    inclusive="both",
)
idx2 = tips.time.isin(input.checkbox_group())
tips_filtered = tips[idx1 & idx2]
```

## Shiny reactive calculations

We can use a `@reactive.calc` to define and save a value that reacts to inputs

```{shinylive-python}
#| standalone: true
#| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500
from shiny import App, reactive, render, ui

app_ui = ui.page_fillable(
    ui.input_slider("bill", "Bill amount ($)", min=1, max=100, value=25),
    ui.output_text("tip_inline"),
    ui.output_text("tip_from_calc"),
)


def server(input, output, session):
    # compute tip directly from the input
    @render.text
    def tip_inline():
        return f"Tip (15%): ${input.bill() * 0.15:.2f}"

    # save the calculation for reuse
    @reactive.calc
    def tip_amount():
        return input.bill() * 0.15

    # use the saved calculation
    @render.text
    def tip_from_calc():
        return f"Tip (saved): ${tip_amount():.2f}"


app = App(app_ui, server)
```


## Reuse reactive calculations

```{shinylive-python}
#| standalone: true
#| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500
from shiny import App, reactive, render, ui

app_ui = ui.page_fillable(
    ui.input_slider("bill", "Bill amount ($)", min=1, max=100, value=25),
    ui.output_text("tip_inline"),
    ui.output_text("tip_from_calc"),
    ui.output_text("total_from_calc"),
    ui.output_text("total_from_input"),
)


def server(input, output, session):
    # compute tip directly from the input
    @render.text
    def tip_inline():
        return f"Tip (15%): ${input.bill() * 0.15:.2f}"

    # save the calculation for reuse
    @reactive.calc
    def tip_amount():
        return input.bill() * 0.15

    # use the saved calculation
    @render.text
    def tip_from_calc():
        return f"Tip (saved): ${tip_amount():.2f}"

    # build on the saved calculation
    @render.text
    def total_from_calc():
        return f"Total with tip: ${input.bill() + tip_amount():.2f}"

    # vs recalculating from scratch every time
    @render.text
    def total_from_input():
        return f"Total (recalc): ${input.bill() + input.bill() * 0.15:.2f}"


app = App(app_ui, server)
```

## Your turn: Filtered tips reactive.calc

```{shinylive-python}
#| standalone: true
#| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500

import seaborn as sns
from shiny import App, reactive, render, ui

tips = sns.load_dataset("tips")

app_ui = ui.page_fillable(
    ui.panel_title("Restaurant tipping"),
    ui.layout_sidebar(
        ui.sidebar(
            ui.input_slider(
                id="slider",
                label="Bill amount",
                min=tips.total_bill.min(),
                max=tips.total_bill.max(),
                value=[tips.total_bill.min(), tips.total_bill.max()],
            ),
            ui.input_checkbox_group(
                id="checkbox_group",
                label="Food service",
                choices={
                    "Lunch": "Lunch",
                    "Dinner": "Dinner",
                },
                selected=[
                    "Lunch",
                    "Dinner",
                ],
            ),
            ui.input_action_button("action_button", "Reset filter"),
            open="desktop",
        ),
        # first row of value boxes
        ui.layout_columns(
            ui.value_box("Total tippers", ui.output_text("total_tippers")),
            fill=False,
        ),
    ),
)


def server(input, output, session):
    @render.text
    def total_tippers():
        idx1 = tips.total_bill.between(
            left=input.slider()[0],
            right=input.slider()[1],
            inclusive="both",
        )
        idx2 = tips.time.isin(input.checkbox_group())
        tips_filtered = tips[idx1 & idx2]
        tips_filtered.shape[0]


app = App(app_ui, server)
```

## The application (Core)

```{shinylive-python}
#| standalone: true
#| #| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 500

{{< include /code/lecture02/core/app.py >}}
```

## Challenge: Button

- Reactive events

<https://shiny.posit.co/py/api/core/reactive.event.html>
